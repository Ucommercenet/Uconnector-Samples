[CmdletBinding()]
Param(
	[Parameter(Mandatory=$False)]
	[string]$OutputDirectory="c:\tmp\uConnector NuGet Package", 
	
	[Parameter(Mandatory=$False)]
	[string]$BuildProject="True"
)

function GetScriptDirectory { 
    Split-Path -parent $PSCommandPath 
}

function Create-Package() {
	try {
	
		$ScriptDirectory = GetScriptDirectory;
		$NuGetSpecFile = $ScriptDirectory + "\..\NuGet\App.Manifest.nuspec";
		$NuGetExeLocation = $ScriptDirectory + "\..\Nuget";

		if (!(Test-Path -Path $OutputDirectory)) {
			Write-Output "Creating directory at " + $OutputDirectory;
			New-Item -ItemType directory -Path $OutputDirectory;
		}
    
    if($BuildProject -eq "True"){
      & "$NuGetExeLocation\nuget.exe" pack $NuGetSpecFile -IncludeReferencedProjects -Build -OutputDirectory $OutputDirectory -Properties Configuration=Release;
    }
    else {
      & "$NuGetExeLocation\nuget.exe" pack $NuGetSpecFile -IncludeReferencedProjects -OutputDirectory $OutputDirectory -Properties Configuration=Release;
    }
	} catch {
		Write-Error $_.Exception.Message -ErrorAction Stop
	}
}

Create-Package